<?php
 function wpchords_plugin_data() { return get_plugin_data(plugin_dir_path(__FILE__).'wpchords.php'); } function wpchords_initializer() { wp_enqueue_script('wpchords_app', plugin_dir_url( __FILE__ ) . 'dist/bundle.js', array(), '1.0.9', true ); $passedValues = array( 'font_size' => get_option('wpchords_toggle_fontsize'), 'transpose' => get_option('wpchords_toggle_transpose'), 'alternating' => get_option('wpchords_toggle_alternating'), 'ajax_url' => admin_url('admin-ajax.php')); wp_localize_script( 'wpchords_app', 'wpchords_opt', $passedValues ); } function wpchords_generator( $content ) { $chord = str_replace(' ', '&nbsp;', $content); $chord = preg_replace('/[ ](?=[^>]*(?:<|$))/', '&nbsp', $content); $chord = $content; $replacor = '/\[[A-Za-z1-9#]{1,6}\]/'; $chord = !wpchords_amp_active() ? preg_replace_callback($replacor, function($m) { return "<nota-component nota=\"".substr($m[0],1,-1)."\"></nota-component>"; }, $chord) : preg_replace_callback($replacor, function($m) { return "<b>[".substr($m[0],1,-1)."]</b>"; }, $chord); if (wpchords_amp_active()) $chord = "<p><a href=\"".preg_replace ('/(.*)\/amp/', '$1', get_permalink())."\">".(!get_option("wpchords_string_deamp") ? "To view full edition please click here" : get_option("wpchords_string_deamp"))."</a></p>".$chord; return "<div class=\"app-handler akorcu-app-handler bs-iso\"><div class=\"header-handler\"><toolbox-component/></div><div class=\"wpChordsBody".((boolean)get_option('wpchords_toggle_monospace') ? ' wpChordsBodyMonospace' : '')."\" v-bind:style=\"{ fontSize: fontsize * 10 + '%' }\">".$chord."</div></div>"; } function wpchords_shortcode( $atts, $content = null ) { wpchords_initializer(); return wpchords_generator($content); } add_shortcode( 'wpchords', 'wpchords_shortcode' ); add_action( 'wp_ajax_get_wpchords', 'wpchords_get_wpchords' ); function wpchords_get_wpchords() { $www = sanitize_textarea_field($_POST['payload']); echo stripslashes(do_shortcode($www)); wp_die(); } add_action('admin_menu', 'wpchords_admin_add_page'); function wpchords_admin_add_page() { add_options_page('WP Chords', wpchords_plugin_data()['Name'], 'manage_options', 'wpchords', 'wpchords_options'); } add_action("admin_init", "wpchords_admin_page_init"); function wpchords_admin_page_init() { add_settings_section("wpchords-section", null, null, "wpchords"); add_settings_field("wpchords_toggle_fontsize", "Hide Font Size Changer", "wpchords_chk_font_size_display", "wpchords", "wpchords-section"); add_settings_field("wpchords_toggle_transpose", "Hide Transpose", "wpchords_chk_chord_changer_display", "wpchords", "wpchords-section"); add_settings_field("wpchords_toggle_alternating", "Display with Alternating Chords", "wpchords_chk_alternating_display", "wpchords", "wpchords-section"); add_settings_field("wpchords_toggle_monospace", "Display with monospace font", "wpchords_chk_monospacefont", "wpchords", "wpchords-section"); add_settings_field("wpchords_string_deamp", "Redirection to full page (If amp is enabled)", "wpchords_str_deamp", "wpchords", "wpchords-section"); register_setting("wpchords-section", "wpchords_toggle_fontsize"); register_setting("wpchords-section", "wpchords_toggle_transpose"); register_setting("wpchords-section", "wpchords_toggle_alternating"); register_setting("wpchords-section", "wpchords_toggle_monospace"); register_setting("wpchords-section", "wpchords_string_deamp"); } function wpchords_chk_font_size_display() { ?>
        <!-- Here we are comparing stored value with 1. Stored value is 1 if user checks the checkbox otherwise empty string. -->
        <input type="checkbox" name="wpchords_toggle_fontsize" value="1" <?php checked(1, get_option('wpchords_toggle_fontsize'), true); ?> />
   <?php
} function wpchords_chk_chord_changer_display() { ?>
        <!-- Here we are comparing stored value with 1. Stored value is 1 if user checks the checkbox otherwise empty string. -->
        <input type="checkbox" name="wpchords_toggle_transpose" value="1" <?php checked(1, get_option('wpchords_toggle_transpose'), true); ?> />
   <?php
} function wpchords_chk_alternating_display() { ?>
        <!-- Here we are comparing stored value with 1. Stored value is 1 if user checks the checkbox otherwise empty string. -->
        <input type="checkbox" name="wpchords_toggle_alternating" value="1" <?php checked(1, get_option('wpchords_toggle_alternating'), true); ?> />
   <?php
} function wpchords_chk_monospacefont() { ?>
        <!-- Here we are comparing stored value with 1. Stored value is 1 if user checks the checkbox otherwise empty string. -->
        <input type="checkbox" name="wpchords_toggle_monospace" value="1" <?php checked(1, get_option('wpchords_toggle_monospace'), true); ?> />
   <?php
} function wpchords_str_deamp() { ?>
        <input type="text" name="wpchords_string_deamp" value="<?php echo esc_attr( get_option('wpchords_string_deamp') ); ?>"/>
   <?php
} function wpchords_amp_active() { return ( function_exists( 'is_amp_endpoint' ) && is_amp_endpoint() ); } ?>